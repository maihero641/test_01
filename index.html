<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ìŠ¤ë„¤ì´í¬ ê²Œì„ (ë‹¨ì¼ HTML)</title>
  <style>
    :root {
      --bg1: #0f172a; /* ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ */
      --bg2: #111827;
      --panel: #0b1220;
      --grid: #1f2937;
      --snake-head: #22d3ee;
      --snake-body: #06b6d4;
      --apple: #ef4444;
      --text: #e5e7eb;
      --subtext: #9ca3af;
      --accent: #38bdf8;
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: radial-gradient(1200px 800px at 30% 20%, var(--bg2), var(--bg1));
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", "Apple SD Gothic Neo", sans-serif;
      overscroll-behavior: none;
    }
    .wrap {
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .game-panel {
      display: grid;
      gap: 14px;
      background: color-mix(in hsl, var(--panel) 90%, black 10%);
      border: 1px solid #0b2440;
      border-radius: 16px;
      padding: 16px;
      width: min(92vmin, 560px);
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 1px rgba(255,255,255,.05);
    }
    .hud {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .title {
      font-weight: 700;
      letter-spacing: .3px;
      color: var(--accent);
      text-shadow: 0 0 10px rgba(56,189,248,0.2);
    }
    .scores {
      display: flex;
      gap: 12px;
      font-variant-numeric: tabular-nums;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: #0a152a;
      border: 1px solid #143257;
      border-radius: 10px;
      color: var(--text);
      font-size: 14px;
    }
    .badge small {
      color: var(--subtext);
    }
    .canvas-wrap {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #17304f;
    }
    canvas {
      display: block;
      width: 100%;
      height: auto;
      image-rendering: pixelated;      /* í”½ì…€ ëŠë‚Œ ìœ ì§€ */
      background: #0a1322;
    }
    .overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: linear-gradient(180deg, rgba(2,6,23,0.35), rgba(2,6,23,0.65));
      backdrop-filter: blur(2px);
      color: var(--text);
      text-align: center;
      padding: 16px;
      gap: 8px;
    }
    .overlay h2 {
      margin: 0 0 4px;
      font-size: 22px;
    }
    .overlay p { margin: 2px 0; color: var(--subtext); }
    .helper {
      font-size: 13px;
      color: var(--subtext);
      line-height: 1.45;
    }
    .hint {
      margin-top: 8px;
      font-size: 12px;
      color: #a3e1ff;
      opacity: .9;
    }
    .footer {
      font-size: 12px;
      color: var(--subtext);
      text-align: center;
    }
    .footer kbd {
      background: #0b1b33;
      border: 1px solid #15345b;
      border-bottom-color: #0b1f3a;
      padding: 2px 6px;
      border-radius: 6px;
      font-weight: 600;
      color: #e6f3ff;
    }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="game-panel">
      <div class="hud">
        <div class="title">ğŸ ìŠ¤ë„¤ì´í¬</div>
        <div class="scores">
          <div class="badge"><small>ì ìˆ˜</small> <strong id="score">0</strong></div>
          <div class="badge"><small>ìµœê³ </small> <strong id="high">0</strong></div>
        </div>
      </div>

      <div class="canvas-wrap">
        <!-- ë…¼ë¦¬ í•´ìƒë„ëŠ” ê³ ì •, í™”ë©´ì— ë§ì¶° ë¹„ìœ¨ ìœ ì§€ -->
        <canvas id="board" width="480" height="480" aria-label="ìŠ¤ë„¤ì´í¬ ë³´ë“œ"></canvas>

        <!-- ê²Œì„ ì‹œì‘ ì•ˆë‚´ ì˜¤ë²„ë ˆì´ (ì²˜ìŒ í‘œì‹œ) -->
        <div class="overlay" id="startOverlay">
          <div>
            <h2>í™”ì‚´í‘œ í‚¤ë¡œ ì´ë™!</h2>
            <p>ë²½ì´ë‚˜ ìê¸° ëª¸ì— ë¶€ë”ªíˆë©´ ê²Œì„ ì˜¤ë²„ì…ë‹ˆë‹¤.</p>
            <div class="helper">
              <div>ğŸ ì‚¬ê³¼ë¥¼ ë¨¹ìœ¼ë©´ ê¸¸ì–´ì§€ê³  ì ìˆ˜ê°€ ì˜¬ë¼ìš”.</div>
              <div>â¸ <kbd>Space</kbd> ì¼ì‹œì •ì§€ / ğŸ” <kbd>Enter</kbd> ì¬ì‹œì‘</div>
            </div>
            <div class="hint">ì•„ë¬´ ë°©í–¥í‚¤ë¥¼ ëˆŒëŸ¬ ì‹œì‘</div>
          </div>
        </div>

        <!-- ì¼ì‹œì •ì§€/ê²Œì„ì˜¤ë²„ ì˜¤ë²„ë ˆì´ (ë™ì  í‘œì‹œ) -->
        <div class="overlay" id="statusOverlay" style="display:none;">
          <div>
            <h2 id="statusTitle">ì¼ì‹œì •ì§€</h2>
            <p id="statusDesc">ê³„ì†í•˜ë ¤ë©´ <kbd>Space</kbd> ë¥¼ ëˆ„ë¥´ì„¸ìš”.</p>
          </div>
        </div>
      </div>

      <div class="footer">
        ì¡°ì‘: <kbd>â†‘</kbd> <kbd>â†“</kbd> <kbd>â†</kbd> <kbd>â†’</kbd> &nbsp;Â·&nbsp; ì¼ì‹œì •ì§€: <kbd>Space</kbd> Â· ì¬ì‹œì‘: <kbd>Enter</kbd>
      </div>
    </section>
  </main>

  <script>
    // ====== ê¸°ë³¸ ì„¤ì • ======
    const CELL = 24;           // ì…€ í¬ê¸°(px)
    const COLS = 20;           // ê°€ë¡œ ì…€ ìˆ˜
    const ROWS = 20;           // ì„¸ë¡œ ì…€ ìˆ˜
    const WIDTH = CELL * COLS; // ìº”ë²„ìŠ¤ ë…¼ë¦¬ í­
    const HEIGHT = CELL * ROWS;// ìº”ë²„ìŠ¤ ë…¼ë¦¬ ë†’ì´

    const canvas = document.getElementById('board');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const highEl = document.getElementById('high');
    const startOverlay = document.getElementById('startOverlay');
    const statusOverlay = document.getElementById('statusOverlay');
    const statusTitle = document.getElementById('statusTitle');
    const statusDesc = document.getElementById('statusDesc');

    // ìº”ë²„ìŠ¤ ë…¼ë¦¬ í¬ê¸° ìœ ì§€ (CSSë¡œ ë°˜ì‘í˜• ìŠ¤ì¼€ì¼)
    canvas.width = WIDTH;
    canvas.height = HEIGHT;

    // ====== ê²Œì„ ìƒíƒœ ======
    let snake;              // [{x,y}, ...] ë¨¸ë¦¬ -> ê¼¬ë¦¬
    let dir;                // í˜„ì¬ ë°©í–¥ {x,y}
    let nextDir;            // ë‹¤ìŒ í”„ë ˆì„ì— ë°˜ì˜í•  ë°©í–¥
    let apple;              // {x,y}
    let score;              // í˜„ì¬ ì ìˆ˜
    let highScore;          // ìµœê³  ì ìˆ˜ (localStorage)
    let running = false;    // ì‹œì‘ ì—¬ë¶€
    let paused = false;     // ì¼ì‹œì •ì§€
    let gameOver = false;   // ê²Œì„ì˜¤ë²„
    let lastTime = 0;       // ì´ì „ í”„ë ˆì„ íƒ€ì„ìŠ¤íƒ¬í”„
    let acc = 0;            // ëˆ„ì  ì‹œê°„ (ms)
    let tickMs = 120;       // í•œ ì¹¸ ì´ë™ ì£¼ê¸°(ms)
    const minTick = 60;     // ìµœê³  ì†ë„ í•œê³„(ms)
    const speedUp = 0.97;   // ì‚¬ê³¼ ë¨¹ì„ ë•Œë§ˆë‹¤ ì†ë„ ì¦ê°€ ê³„ìˆ˜

    // ====== ì´ˆê¸°í™” / ì¬ì‹œì‘ ======
    function resetGame() {
      // ì´ˆê¸° ë±€ (ê¸¸ì´ 3)
      const startX = Math.floor(COLS / 2);
      const startY = Math.floor(ROWS / 2);
      snake = [
        { x: startX, y: startY },
        { x: startX - 1, y: startY },
        { x: startX - 2, y: startY },
      ];
      dir = { x: 1, y: 0 };
      nextDir = { ...dir };
      score = 0;
      scoreEl.textContent = score;
      gameOver = false;
      paused = false;
      acc = 0;
      tickMs = 120; // ì´ˆê¸° ì†ë„
      spawnApple();

      // ì˜¤ë²„ë ˆì´ ì²˜ë¦¬
      startOverlay.style.display = running ? 'none' : '';
      statusOverlay.style.display = 'none';
      draw(); // ì´ˆê¸° í™”ë©´
    }

    // ====== ì‚¬ê³¼ ìƒì„± (ë±€ê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ) ======
    function spawnApple() {
      while (true) {
        const x = Math.floor(Math.random() * COLS);
        const y = Math.floor(Math.random() * ROWS);
        const conflict = snake.some(seg => seg.x === x && seg.y === y);
        if (!conflict) {
          apple = { x, y };
          return;
        }
      }
    }

    // ====== ë©”ì¸ ë£¨í”„ ======
    function loop(timestamp) {
      if (!running) return; // ì‹œì‘ ì „ì—ëŠ” ë£¨í”„ ì •ì§€

      const dt = Math.min(32, timestamp - lastTime); // í”„ë ˆì„ ë³€ë™ ì–µì œ
      lastTime = timestamp;

      if (!paused && !gameOver) {
        acc += dt;
        while (acc >= tickMs) {
          acc -= tickMs;
          step();
        }
      }

      draw();
      requestAnimationFrame(loop);
    }

    // ====== í•œ í‹± ì§„í–‰ ======
    function step() {
      // ë°©í–¥ ë°˜ì˜ (í‹±ë‹¹ 1íšŒë§Œ ë³€ê²½ë˜ë„ë¡)
      dir = nextDir;

      // ìƒˆ ë¨¸ë¦¬ ìœ„ì¹˜
      const head = snake[0];
      const newHead = { x: head.x + dir.x, y: head.y + dir.y };

      // ë²½ ì¶©ëŒ ê²€ì‚¬ (wrapì„ ì›í•˜ë©´ ì—¬ê¸° ë¡œì§ ë°”ê¾¸ë©´ ë¨)
      if (newHead.x < 0 || newHead.y < 0 || newHead.x >= COLS || newHead.y >= ROWS) {
        return endGame();
      }

      // ìê¸° ëª¸ ì¶©ëŒ ê²€ì‚¬ (ìƒˆ ë¨¸ë¦¬ê°€ ëª¸ê³¼ ê²¹ì¹˜ëŠ”ì§€)
      if (snake.some(seg => seg.x === newHead.x && seg.y === newHead.y)) {
        return endGame();
      }

      // ì´ë™
      snake.unshift(newHead);

      // ì‚¬ê³¼ ë¨¹ì—ˆëŠ”ì§€ í™•ì¸
      if (newHead.x === apple.x && newHead.y === apple.y) {
        score += 10;
        scoreEl.textContent = score;
        spawnApple();
        // ì†ë„ ìƒìŠ¹ (ìµœì†Œ í•œê³„ ìœ ì§€)
        tickMs = Math.max(minTick, Math.floor(tickMs * speedUp));
      } else {
        // ì‚¬ê³¼ë¥¼ ë¨¹ì§€ ì•Šì•˜ìœ¼ë©´ ê¼¬ë¦¬ ì œê±°
        snake.pop();
      }
    }

    function endGame() {
      gameOver = true;
      paused = false;
      updateHighScore();
      showStatus('ê²Œì„ ì˜¤ë²„', 'ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ Enter í‚¤ë¥¼ ëˆ„ë¥´ì„¸ìš”.');
    }

    // ====== ê·¸ë¦¬ê¸° ======
    function draw() {
      // ë°°ê²½
      ctx.fillStyle = '#071124';
      ctx.fillRect(0, 0, WIDTH, HEIGHT);

      // ë³´ë“œ ê·¸ë¦¬ë“œ
      drawGrid();

      // ì‚¬ê³¼
      drawApple(apple.x, apple.y);

      // ë±€ (ë¨¸ë¦¬ ê°•ì¡°)
      drawSnake();

      // ìƒíƒœ ì˜¤ë²„ë ˆì´ëŠ” DOM ìš”ì†Œë¡œ ì²˜ë¦¬
    }

    function drawGrid() {
      ctx.save();
      ctx.strokeStyle = '#10213d';
      ctx.lineWidth = 1;

      // ì–‡ì€ ë¼ì¸
      ctx.globalAlpha = 0.35;
      for (let x = 1; x < COLS; x++) {
        ctx.beginPath();
        ctx.moveTo(x * CELL + 0.5, 0);
        ctx.lineTo(x * CELL + 0.5, HEIGHT);
        ctx.stroke();
      }
      for (let y = 1; y < ROWS; y++) {
        ctx.beginPath();
        ctx.moveTo(0, y * CELL + 0.5);
        ctx.lineTo(WIDTH, y * CELL + 0.5);
        ctx.stroke();
      }

      // ì™¸ê³½ì„ 
      ctx.globalAlpha = 1;
      ctx.strokeStyle = '#143257';
      ctx.lineWidth = 2;
      ctx.strokeRect(1, 1, WIDTH - 2, HEIGHT - 2);
      ctx.restore();
    }

    function drawApple(x, y) {
      const px = x * CELL;
      const py = y * CELL;
      ctx.save();
      // ë³¸ì²´
      ctx.fillStyle = '#ef4444';
      const pad = 3;
      ctx.fillRect(px + pad, py + pad, CELL - pad * 2, CELL - pad * 2);
      // í•˜ì´ë¼ì´íŠ¸
      ctx.fillStyle = 'rgba(255,255,255,.15)';
      ctx.fillRect(px + pad + 2, py + pad + 2, CELL - pad * 2 - 8, 6);
      // ìì‚¬ê·€
      ctx.fillStyle = '#22c55e';
      ctx.fillRect(px + CELL / 2 - 2, py + pad - 2, 6, 6);
      ctx.restore();
    }

    function drawSnake() {
      for (let i = 0; i < snake.length; i++) {
        const seg = snake[i];
        const px = seg.x * CELL;
        const py = seg.y * CELL;

        if (i === 0) {
          // ë¨¸ë¦¬
          const grad = ctx.createLinearGradient(px, py, px + CELL, py + CELL);
          grad.addColorStop(0, '#22d3ee');
          grad.addColorStop(1, '#06b6d4');
          ctx.fillStyle = grad;
          roundRect(ctx, px + 2, py + 2, CELL - 4, CELL - 4, 6, true);
        } else {
          // ëª¸í†µ
          ctx.fillStyle = '#0ea5b0';
          roundRect(ctx, px + 3, py + 3, CELL - 6, CELL - 6, 5, true);
        }
      }
    }

    // ë‘¥ê·¼ ì‚¬ê°í˜• ìœ í‹¸
    function roundRect(ctx, x, y, w, h, r, fill, stroke) {
      const min = Math.min(w, h) / 2;
      if (r > min) r = min;
      ctx.beginPath();
      ctx.moveTo(x + r, y);
      ctx.arcTo(x + w, y, x + w, y + h, r);
      ctx.arcTo(x + w, y + h, x, y + h, r);
      ctx.arcTo(x, y + h, x, y, r);
      ctx.arcTo(x, y, x + w, y, r);
      ctx.closePath();
      if (fill) ctx.fill();
      if (stroke) ctx.stroke();
    }

    // ====== ì…ë ¥ ì²˜ë¦¬ ======
    // ë¸Œë¼ìš°ì € ìŠ¤í¬ë¡¤ ë°©ì§€ (í™”ì‚´í‘œ/ìŠ¤í˜ì´ìŠ¤/ì—”í„°)
    window.addEventListener('keydown', (e) => {
      const keysToBlock = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' ' , 'Enter'];
      if (keysToBlock.includes(e.key)) e.preventDefault();
    }, { passive: false });

    window.addEventListener('keydown', (e) => {
      const k = e.key;

      // ì‹œì‘ ì „: ë°©í–¥í‚¤ ëˆ„ë¥´ë©´ ê²Œì„ ì‹œì‘
      if (!running) {
        if (k.startsWith('Arrow')) {
          running = true;
          startOverlay.style.display = 'none';
          lastTime = performance.now();
          requestAnimationFrame(loop);
        } else {
          return;
        }
      }

      // ê²Œì„ì˜¤ë²„ ìƒíƒœì—ì„œ Enterë¡œ ì¬ì‹œì‘
      if (gameOver) {
        if (k === 'Enter') {
          resetGame();
        }
        return;
      }

      // ì¼ì‹œì •ì§€ í† ê¸€
      if (k === ' ') {
        paused = !paused;
        if (paused) {
          showStatus('ì¼ì‹œì •ì§€', 'ê³„ì†í•˜ë ¤ë©´ Space í‚¤ë¥¼ ëˆ„ë¥´ì„¸ìš”.');
        } else {
          hideStatus();
        }
        return;
      }

      // ì§„í–‰ ì¤‘ ë°©í–¥ ì „í™˜
      const d = getDirFromKey(k);
      if (!d) return;

      // ì—­ë°©í–¥ ê¸ˆì§€ (ì¦‰ì‹œ ìœ í„´ ë°©ì§€)
      if (d.x + dir.x === 0 && d.y + dir.y === 0) return;

      // ê°™ì€ í‹±ì— ì—¬ëŸ¬ ë²ˆ êº¾ê¸° ë°©ì§€: nextDir ê¸°ì¤€ìœ¼ë¡œë„ ì—­ë°©í–¥ í™•ì¸
      if (d.x + nextDir.x === 0 && d.y + nextDir.y === 0) return;

      nextDir = d;
      // ì²« ì…ë ¥ ì‹œ ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
      hideStatus();
    });

    function getDirFromKey(k) {
      switch (k) {
        case 'ArrowUp':    return { x: 0, y: -1 };
        case 'ArrowDown':  return { x: 0, y:  1 };
        case 'ArrowLeft':  return { x: -1, y: 0 };
        case 'ArrowRight': return { x:  1, y: 0 };
        default: return null;
      }
    }

    // ====== ì ìˆ˜ ì €ì¥ ======
    function updateHighScore() {
      highScore = Math.max(highScore || 0, score);
      localStorage.setItem('snake_high_score', String(highScore));
      highEl.textContent = highScore;
    }

    // ====== ìƒíƒœ ì˜¤ë²„ë ˆì´ í‘œì‹œ/ìˆ¨ê¹€ ======
    function showStatus(title, desc) {
      statusTitle.textContent = title;
      statusDesc.innerHTML = desc.replace('Enter', '<kbd>Enter</kbd>').replace('Space', '<kbd>Space</kbd>');
      statusOverlay.style.display = '';
    }
    function hideStatus() {
      statusOverlay.style.display = 'none';
    }

    // ====== ì‹œì‘ ì¤€ë¹„ ======
    highScore = Number(localStorage.getItem('snake_high_score') || 0);
    highEl.textContent = highScore;
    resetGame(); // ë‚´ë¶€ì—ì„œ draw í˜¸ì¶œ

    // í¬ì»¤ìŠ¤ ì´íƒˆ/ë³µê·€ ì‹œ ìë™ ì¼ì‹œì •ì§€ (ì˜¤ë™ì‘ ë°©ì§€)
    window.addEventListener('blur', () => {
      if (running && !gameOver) {
        paused = true;
        showStatus('ì¼ì‹œì •ì§€', 'ì°½ì„ ë²—ì–´ë‚˜ ì¼ì‹œì •ì§€ ë˜ì—ˆìŠµë‹ˆë‹¤. ê³„ì†í•˜ë ¤ë©´ <kbd>Space</kbd>.');
      }
    });
    window.addEventListener('focus', () => {
      // ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ í’€ë„ë¡ ìœ ì§€
    });
  </script>
</body>
</html>
